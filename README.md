# Демонстрация кластеризации точек на карте

Проект демонстрирует работу кластеризации точек недвижимости на карте с использованием:
- **Backend**: Go (Gin framework)
- **Frontend**: JavaScript, Яндекс.Карты
- **База данных**: PostgreSQL
- **Контейнеризация**: Docker

## Особенности

- 100,000 случайных объектов недвижимости в Новосибирске
- Кластеризация по тайлам на стороне базы данных
- Адаптивный размер кластеров в зависимости от уровня зума
- Интерактивная карта с Яндекс.Картами
- Визуализация статистики по кластерам

## Структура проекта

```
.
├── docker-compose.yml    # Конфигурация Docker Compose
├── Dockerfile           # Образ для Go приложения
├── go.mod               # Зависимости Go
├── main.go              # Основной сервер на Go
├── init.sql             # Инициализация БД и тестовые данные
├── templates/
│   └── index.html       # HTML шаблон с картой
├── static/
│   └── style.css        # Дополнительные стили
└── README.md            # Документация
```

## Запуск проекта

### 1. Клонирование и подготовка

```bash
git clone <repository-url>
cd real-estate-clustering
```

### 2. Настройка API ключа Яндекс.Карт

Откройте файл `templates/index.html` и замените `your-api-key` на ваш API ключ Яндекс.Карт:

```javascript
<script src="https://api-maps.yandex.ru/2.1/?apikey=YOUR_ACTUAL_API_KEY&lang=ru_RU" type="text/javascript"></script>
```

### 3. Запуск с Docker Compose

```bash
docker-compose up --build
```

### 4. Доступ к приложению

Откройте браузер и перейдите по адресу: http://localhost:8080

## API Endpoints

### Получение кластеров
```
GET /api/clusters?min_lat={lat}&max_lat={lat}&min_lng={lng}&max_lng={lng}&zoom={level}
```

**Параметры:**
- `min_lat`, `max_lat` - границы по широте
- `min_lng`, `max_lng` - границы по долготе  
- `zoom` - уровень зума карты

**Ответ:**
```json
[
  {
    "cluster_id": 123,
    "center_lat": 54.9833,
    "center_lng": 82.8963,
    "point_count": 15,
    "avg_price": 8500000.50,
    "min_price": 5000000.00,
    "max_price": 12000000.00
  }
]
```

### Получение отдельных объектов
```
GET /api/properties?min_lat={lat}&max_lat={lat}&min_lng={lng}&max_lng={lng}&limit={count}
```

## Алгоритм кластеризации

Кластеризация реализована на уровне базы данных PostgreSQL:

1. **Разделение на тайлы**: Область карты разбивается на квадратные тайлы
2. **Размер тайла**: Зависит от уровня зума:
   - Zoom ≤ 10: 0.1° (крупные кластеры)
   - Zoom ≤ 12: 0.05°
   - Zoom ≤ 14: 0.02°
   - Zoom ≤ 16: 0.01°
   - Zoom ≤ 18: 0.005°
   - Zoom > 18: 0.002° (мелкие кластеры)
3. **Группировка**: Точки группируются по тайлам
4. **Статистика**: Для каждого кластера вычисляется:
   - Количество точек
   - Средняя цена
   - Минимальная и максимальная цена

## Функциональность

### На карте
- **Кластеры**: Отображаются как круги с количеством объектов
- **Цвета**: Зависят от количества точек в кластере
- **Информация**: При наведении показывается статистика кластера
- **Зум**: При увеличении кластеры разбиваются на более мелкие

### Информационная панель
- Уровень зума карты
- Количество кластеров
- Общее количество объектов
- Средняя цена по видимой области

## Технические детали

### База данных
- PostgreSQL 15
- Индексы для быстрого поиска по координатам
- Функция `get_clusters()` для кластеризации
- 100,000 тестовых объектов недвижимости

### Backend (Go)
- Gin web framework
- Подключение к PostgreSQL
- REST API для получения кластеров и объектов
- CORS поддержка

### Frontend (JavaScript)
- Яндекс.Карты API
- Асинхронная загрузка данных
- Интерактивные кластеры
- Адаптивный дизайн

## Разработка

### Локальная разработка без Docker

1. Установите Go и PostgreSQL
2. Создайте базу данных и выполните `init.sql`
3. Установите зависимости: `go mod download`
4. Запустите сервер: `go run main.go`

### Переменные окружения

```bash
DB_HOST=localhost
DB_PORT=5432
DB_NAME=real_estate
DB_USER=postgres
DB_PASSWORD=password
```

## Лицензия

MIT License 